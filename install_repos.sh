echo "==================================================================="
echo "BUILDING ZIMBRA P25 LOCAL REPO"
echo "==================================================================="
scriptDir=$(pwd)

rpm --import https://files.zimbra.com/downloads/security/public.key

echo "
[zimbra]
name=Zimbra RPM Repository
baseurl=https://repo.zimbra.com/rpm/87/rhel8
gpgcheck=1
enabled=1

[zimbra-90-oss]
name=Zimbra New RPM Repository
baseurl=https://repo.zimbra.com/rpm/90/rhel8
gpgcheck=1
enabled=1

[zimbra-90-network]
name=Zimbra New RPM Repository
baseurl=https://repo.zimbra.com/rpm/90-ne/rhel8
gpgcheck=1
enabled=1
" > /etc/yum.repos.d/zimbra.repo

dnf repolist
dnf makecache

installTempDir="/opt/tmp_zimbra_instalation_files"
repoDir="/opt/zimbra_p25_repo"
mkdir $installTempDir
mkdir $repoDir
dnf download --downloadonly $(cat $scriptDir/p25_deps.txt | xargs) --downloaddir=$repoDir

echo "
[zimbra_p25_custom]
name=Zimbra p25 Repo
enabled=1
baseurl=file://$repoDir
gpgchecked=0
" > /etc/yum.repos.d/zimbra_p25_custom.repo

dnf config-manager â€”-set-disable zimbra zimbra-90-oss zimbra-90-network
dnf repolist
dnf makecache
